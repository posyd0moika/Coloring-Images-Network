# Coloring-Images-Network

Цель:
Обучить сеть расскрашивать изображения.

Это проект создан для решение проблемы расскрашивания изображений.
Эволюция проекта:.
  1) Я научился расскаришвать несколько изображений, сеть была типа fullCNN, просто были сверточные слои  VGG19
  и потом они развертывались и исходному формату, и приводились к размерности (224х224х2), где 2 - это недостаюшие элементы изображения

  2) Потом я сконстурировал сеть для расскарашивания буквально 5 изображений, разного типа, где было 2 сети, первая это Автоэнкодер, где в середине к нему присоеденялся слой с выхода второй сети, вторая сеть была просто классификатором,
  такая сехма научилась, расскрашивать буквально пару изображений, само собой сеть, на новых данных вообше не чего не может сделать.

  3) Финальная. О ней пойдет речь дальше

# Конструкция сети

В разраюотке сети, я решил воспользоваться нескольким новыми подходами - это Skip Connection и Inception. Раньше, результат классификатора, изменялся в размерност и умножался нескольок раз. классификатор и раскрашивающся модель, это разных модели, где для каждой есть своя метрика и свой loss.
В момнете классификации, у нас сеть разветряеться и одна чать идет на классификатор, а другая на в "преоброзователь", где мы ветор 512, еще раз пропускаем через полносвязный слой из 512 нейровнов. 
И дальше для каждого уровня транспонированной сети к ней просоденедлся, не только паролельный скип коннекстион, с начала сити, но и также результат с "преоброзователя".

Такая получилась сеть.

...

ссылка на figma  ...

Обучал я в Colab, каждая эпоха длилась примерно до 800 сек. Обучал 33 эпохи, но посути после 15, обучение было бесмысленное.
В данной сети, по хрошему надо уменьшить(подобрать), количество нейровнов в слое который развелтяреться на классификтор и в "преоброзователь". Так же возможно добавить Dropout перед псоледним слоем класиификации.
Так как классификатор заметро переобучался, но я на это не обращал внинмание, так как основаная цель проекта, была научить расскарашивать изображения, а не их классифировать. Но по скольку дата сет у меня был для размечен как для классификации, я решил релизовать 2 варианта.

# О данных

Я хотел выбрать данные не совсем стандартые, поэтому выбрал дата сет(далее ДС) на кагле с бабочками 
https://www.kaggle.com/datasets/gpiosenka/butterfly-images40-species


Вот пример нескольких экземлпров ДС, справа оригинальные данные, слева данные, которые я подаю на вход нейросети(НС).
![output2](https://github.com/semenshestakov/Coloring-Images-Network/assets/94396766/c61b9bac-d60c-40df-99e1-b52c6b6fbbab)


# Как я преоброзовал данные? 
По скольку данные у нас в RGB, я из преоброзую в LAB, где вход в НС это L, а требую на выход AB, где L - это диапозон от 0 до 100, а AB диапозон от -1 до 1. Выбор функции активации очивиден - это гиперболический тангенс.

https://avatars.mds.yandex.net/get-images-cbir/371729/s_sBw6Ki4LByJ-eREvIwvA6347/ocr![image](https://github.com/semenshestakov/Coloring-Images-Network/assets/94396766/ebc3acd1-6325-4715-bef5-628c068a07b3)

Данные L -  методом опытных путей, я пришел к выводу, что для RESnet50(выбор для классификации) необходимо данные подавать не в диапозоне от 0 до 1, а что-то посерезней, от 0 до 100 - подходит. А для сети для расскрашивания, лучше подходит диапозон от 0 до 1. 
Поэтому на выход НС подаёться изображение L в диапозоне от 0 до 1,а где сеть расходиться в 2 стороныб то для RESnet50 данные умножаються на 100. 

# Результаты 
После обучения сети получились такие результаты:
Обучался, я само собой на тренировочной выборке около 12000 элеменнтов, а смоторел на результаты на валидацоннной. mse все время у то и той выборки был примерно одинаковый. НО полсе 25 эпохи различие между валидацией и тренировочнйо выборки были все больше и большое, по истогу обучения (33 эпоха) mse - 0.009..., а val_mse примерно 0.0125 (К сожалению collab ограничивает длинну сесии поэтому не получилось сохранить результат, но после обучения сети я понял как можно сохранять результат )

![res 5ep](https://github.com/semenshestakov/Coloring-Images-Network/assets/94396766/efa8a3c0-783b-421a-9927-d73f4c27561e)
![res25ep](https://github.com/semenshestakov/Coloring-Images-Network/assets/94396766/fce19c8a-2a33-40fc-b352-52bd5baa28c1)
![res 33ep](https://github.com/semenshestakov/Coloring-Images-Network/assets/94396766/67d4305b-386a-47c5-a9b9-88c102821e96)

![res 5ep(2)](https://github.com/semenshestakov/Coloring-Images-Network/assets/94396766/da982216-bed9-4217-84aa-14df597eac97)
![res ep25(2)](https://github.com/semenshestakov/Coloring-Images-Network/assets/94396766/adee61a7-1b10-4c62-8a7e-0ba0f6108e8a)
![res 33ep(2)](https://github.com/semenshestakov/Coloring-Images-Network/assets/94396766/29e234a3-dd1c-4c53-b921-2285be85b11d)

![output](https://github.com/semenshestakov/Coloring-Images-Network/assets/94396766/271ea7ce-9795-45ee-afbd-9f86b1b48ca3)


Еще несколько вариантов, как выглядит расскрашивание на данных где не видно оригинал:
![Unknown-16](https://github.com/semenshestakov/Coloring-Images-Network/assets/94396766/8eefb1f4-a417-4fe4-ab73-30d76e86431a)
![Unknown-11](https://github.com/semenshestakov/Coloring-Images-Network/assets/94396766/597d2061-63fd-422a-8458-28a79600fdf0)
![Unknown-18](https://github.com/semenshestakov/Coloring-Images-Network/assets/94396766/ea20f00f-94af-469e-988e-0e2106d8deb0)
![Unknown-17](https://github.com/semenshestakov/Coloring-Images-Network/assets/94396766/a5d35f68-70ed-4396-9f31-f90e58623030)


Гепотиза 1. Можно обратить внимание, что края достаточно четкие, это я думаю, потому что в Inception были исполльзованы свертки 1х1, которые хорошо сохраняют исходные края.
Если посомтреть результаты походых по структуре сетей, то очень брасаеться в глаз, что раскрашивание очень размытое, но и обучались такие сети на других данных. 

Гепотиза 2. Сложность данных. По скольую обычние ДС, которые  состоят из раных форм жизни или разных обектов, то в этих данных проще найти раличие цветов, а что касаемо бабочек, то форма неоторых из них очень схожи, и разветление от классификатора и начлие классификатора позовляет, понять какую цветовую политру использовать при раскрашивании. Это позовляет добиться хорошего резльутат в выборе цветов, нейросети.

